CREATE TABLE EMPLOYEES(
	ID INT PRIMARY KEY,
	NAME VARCHAR(50),
	SURNAME VARCHAR(50),
	HOME_ADDRESS VARCHAR(200),
	EMAIL_ADDRESS VARCHAR(50),
	PHONE_NUMBER VARCHAR(20),
	DATE_BIRTH VARCHAR(20),
	SALARY INT
);

CREATE TABLE CUSTOMERS(
	CUSTOMER_ID INT PRIMARY KEY,
	NAME VARCHAR(50),
	SURNAME VARCHAR(50),
	HOME_ADDRESS VARCHAR(200),
	EMAIL_ADDRESS VARCHAR(50),
	PHONE_NUMBER VARCHAR(20),
	DATE_BIRTH date
);

CREATE TABLE  PRODUCTS(
	PRODUCT_ID INT PRIMARY KEY,
	PRODUCT_CATOOOGORY VARCHAR(50) NOT NULL,
	PRODUCT_NAME VARCHAR(50),
	PRODUCT_MODEL VARCHAR(50) NOT NULL,
	CUSTOMER_RATING INT NOT NULL,
	TYPE_COMPUTER_TYPE_INFORMATION VARCHAR(50),
	TYPE_PHONE_OPERATING_SYSTEM VARCHAR(50),
	COLOR VARCHAR(50) NOT NULL,
	RAM_CAPACITY INT NOT NULL,
	PRICE INT NOT NULL,
	COMPUTER_PROCESSOR_TECHNOLOGY VARCHAR(50),
	COMPUTER_MONITOR_SIZE INT,
	STOCK_COUNT INT
);
CREATE TABLE SALES
(
	SALE_ID INT PRIMARY KEY,
	DATE_OF_SALE VARCHAR(50),
	CUSTOMET_RATING INT

);
ALTER TABLE SALES ADD COLUMN SOLD_BY_WHOM INT REFERENCES EMPLOYEES(ID) ON DELETE CASCADE;
ALTER TABLE SALES ADD COLUMN SOLD_TO_WHOM INT REFERENCES CUSTOMERS(CUSTOMER_ID) ON DELETE CASCADE;


CREATE TABLE SALE_PRODUCT(

);

ALTER TABLE SALE_PRODUCT ADD COLUMN SALE INT REFERENCES SALES(SALE_ID) ON DELETE CASCADE;
ALTER TABLE SALE_PRODUCT ADD COLUMN PRODUCT INT REFERENCES PRODUCTS(PRODUCT_ID) ON DELETE CASCADE;

INSERT INTO CUSTOMERS (CUSTOMER_ID,NAME, SURNAME, HOME_ADDRESS, EMAIL_ADDRESS,PHONE_NUMBER,DATE_BIRTH)
VALUES(2712,'ŞÜKRİYE','YANDANÇARKLI','MAKEDONYA','KACIRINBENI.COM','1234567', '02-01-1995');

INSERT INTO CUSTOMERS (CUSTOMER_ID,NAME, SURNAME, HOME_ADDRESS, EMAIL_ADDRESS,PHONE_NUMBER,DATE_BIRTH)
VALUES(2713,'ŞEHRİBAN','HORTUMTUTAN','UGANDA','BALKONDANATBENİİNAŞAĞITUTBENİ.COM','1234568', '02-01-1935');

INSERT INTO CUSTOMERS (CUSTOMER_ID,NAME, SURNAME, HOME_ADDRESS, EMAIL_ADDRESS,PHONE_NUMBER,DATE_BIRTH)
VALUES(2714,'OKYUTAN','OTURAMAYAN','KIZILDERE','AYAKTAYAZDIM.COM','1234569', '02-09-1845');

INSERT INTO CUSTOMERS (CUSTOMER_ID,NAME, SURNAME, HOME_ADDRESS, EMAIL_ADDRESS,PHONE_NUMBER,DATE_BIRTH)
VALUES(2715,'KANGURU','SOYADIYOK','AVUSTURALYAMERKEZZIPLAYANKÖYÜ','AMUDAKALKARKENGÖRBENİ.COM','1234568', '22-01-1995');

INSERT INTO CUSTOMERS (CUSTOMER_ID,NAME, SURNAME, HOME_ADDRESS, EMAIL_ADDRESS,PHONE_NUMBER,DATE_BIRTH)
VALUES(2716,'KALEMTRAŞ','CORTLAYAN','CORTEGA','KALEMİNİSEVDİMARABANIÇİZDİM.COM','1234569', '22-01-2995');
--INSERT EMPLOYEES--
INSERT INTO EMPLOYEES (ID,NAME, SURNAME, HOME_ADDRESS, EMAIL_ADDRESS,PHONE_NUMBER,DATE_BIRTH,SALARY)
VALUES(127,'OYA','TOPAT','ENDONEZYA','KALEMİMİALDIM.COM','12321', '22-01-2022',2000);

INSERT INTO EMPLOYEES (ID,NAME, SURNAME, HOME_ADDRESS, EMAIL_ADDRESS,PHONE_NUMBER,DATE_BIRTH,SALARY)
VALUES(128,'AYOL','TOPTUT','MALEZYA','SİLGİMİÇALDIM.COM','4654556', '12-07-2500',8562);

INSERT INTO EMPLOYEES (ID,NAME, SURNAME, HOME_ADDRESS, EMAIL_ADDRESS,PHONE_NUMBER,DATE_BIRTH,SALARY)
VALUES(129,'KUKULET','TOPKES','YİRİCEK','ÇANTAMIKOPARDIM.COM','451', '18-10-1900',500);

INSERT INTO EMPLOYEES (ID,NAME, SURNAME, HOME_ADDRESS, EMAIL_ADDRESS,PHONE_NUMBER,DATE_BIRTH,SALARY)
VALUES(121,'ŞÜKRÜŞ','TOPCORTLAT','YİYECEK','ARKADAŞIMIYİDİM.COM','00000', '23-07-2036',4215);

INSERT INTO EMPLOYEES (ID,NAME, SURNAME, HOME_ADDRESS, EMAIL_ADDRESS,PHONE_NUMBER,DATE_BIRTH,SALARY)
VALUES(122,'ŞÜKUFE','TOPMORTLAR','YİMEYECEK','HAYDİBANAALKIŞ.COM','88885', '17-05-1999',3200);

--Answer 1 --

SELECT * FROM CUSTOMERS 
WHERE DATE_BIRTH > '01-01-1995'::date

--INSERT PRODUCTS--

INSERT INTO PRODUCTS (PRODUCT_ID,PRODUCT_CATOOOGORY, PRODUCT_NAME, PRODUCT_MODEL, CUSTOMER_RATING,TYPE_COMPUTER_TYPE_INFORMATION,COLOR,RAM_CAPACITY,PRICE,COMPUTER_PROCESSOR_TECHNOLOGY,COMPUTER_MONITOR_SIZE,STOCK_COUNT)
VALUES(7,'COMPUTER','COMPUTER0','ASUS',5,'DESKTOP','BLUE',2000,1750,'INTEL',150,5);

INSERT INTO PRODUCTS (PRODUCT_ID,PRODUCT_CATOOOGORY, PRODUCT_NAME, PRODUCT_MODEL, CUSTOMER_RATING,TYPE_COMPUTER_TYPE_INFORMATION,COLOR,RAM_CAPACITY,PRICE,COMPUTER_PROCESSOR_TECHNOLOGY,COMPUTER_MONITOR_SIZE,STOCK_COUNT)
VALUES(2,'COMPUTER','COMPUTER2','SAMSUNG',1,'LAPTOP','PINK',1500,1250,'ARM',175,3);

INSERT INTO PRODUCTS (PRODUCT_ID,PRODUCT_CATOOOGORY, PRODUCT_NAME, PRODUCT_MODEL, CUSTOMER_RATING,TYPE_COMPUTER_TYPE_INFORMATION,COLOR,RAM_CAPACITY,PRICE,COMPUTER_PROCESSOR_TECHNOLOGY,COMPUTER_MONITOR_SIZE,STOCK_COUNT)
VALUES(3,'COMPUTER','COMPUTER3','ASUS',7,'LAPTOP','YELLOW',1250,1200,'INTEL',150,8);

INSERT INTO PRODUCTS (PRODUCT_ID,PRODUCT_CATOOOGORY, PRODUCT_NAME, PRODUCT_MODEL, CUSTOMER_RATING,TYPE_COMPUTER_TYPE_INFORMATION,COLOR,RAM_CAPACITY,PRICE,COMPUTER_PROCESSOR_TECHNOLOGY,COMPUTER_MONITOR_SIZE,STOCK_COUNT)
VALUES(4,'COMPUTER','COMPUTER4','SAMSUNG',9,'LAPTOP','ORANGE',2860,1333,'INTEL',122,12);

INSERT INTO PRODUCTS (PRODUCT_ID,PRODUCT_CATOOOGORY, PRODUCT_NAME, PRODUCT_MODEL, CUSTOMER_RATING,TYPE_PHONE_OPERATING_SYSTEM,COLOR,RAM_CAPACITY,PRICE,STOCK_COUNT)
VALUES(1,'PHONE','PHONE1','SAMSUNG',3,'IOS','GREEN',888,250,8);

INSERT INTO PRODUCTS (PRODUCT_ID,PRODUCT_CATOOOGORY, PRODUCT_NAME, PRODUCT_MODEL, CUSTOMER_RATING,TYPE_PHONE_OPERATING_SYSTEM,COLOR,RAM_CAPACITY,PRICE,STOCK_COUNT)
VALUES(5,'PHONE','PHONE5','LENOVA',9,'ANDROID','BLUE',452,965,0);

INSERT INTO PRODUCTS (PRODUCT_ID,PRODUCT_CATOOOGORY, PRODUCT_NAME, PRODUCT_MODEL, CUSTOMER_RATING,TYPE_PHONE_OPERATING_SYSTEM,COLOR,RAM_CAPACITY,PRICE,STOCK_COUNT)
VALUES(6,'PHONE','PHONE6','LENOVA',2,'IOS','PURPULE',367,742,3);

--INSERT SALES--

INSERT INTO SALES(SOLD_BY_WHOM,SOLD_TO_WHOM,SALE_ID,DATE_OF_SALE,CUSTOMET_RATING)
VALUES(128,2713,0,'11-07-2001',2);

INSERT INTO SALE_PRODUCT(SALE,PRODUCT)
VALUES(0,7);

INSERT INTO SALES(SOLD_BY_WHOM,SOLD_TO_WHOM,SALE_ID,DATE_OF_SALE,CUSTOMET_RATING)
VALUES(129,2713,1,'01-08-2001',2);

INSERT INTO SALE_PRODUCT(SALE,PRODUCT)
VALUES(0,5);

INSERT INTO SALES(SOLD_BY_WHOM,SOLD_TO_WHOM,SALE_ID,DATE_OF_SALE,CUSTOMET_RATING)
VALUES(122,2713,2,'21-01-3201',2);

INSERT INTO SALE_PRODUCT(SALE,PRODUCT)
VALUES(1,1);
INSERT INTO SALE_PRODUCT(SALE,PRODUCT)
VALUES(1,6);

INSERT INTO SALES(SOLD_BY_WHOM,SOLD_TO_WHOM,SALE_ID,DATE_OF_SALE,CUSTOMET_RATING)
VALUES(129,2713,3,'01-01-2701',2);

INSERT INTO SALES(SOLD_BY_WHOM,SOLD_TO_WHOM,SALE_ID,DATE_OF_SALE,CUSTOMET_RATING)
VALUES(129,2713,10,'01-01-3701',3);

INSERT INTO SALE_PRODUCT(SALE,PRODUCT)
VALUES(2,5);

INSERT INTO SALE_PRODUCT(SALE,PRODUCT)
VALUES(2,7);

INSERT INTO SALE_PRODUCT(SALE,PRODUCT)
VALUES(2,5);

INSERT INTO SALE_PRODUCT(SALE,PRODUCT)
VALUES(2,5);

select * from sales
select * from sale_product
select * from products

select product_id, product_name, sale_product.product, sale_product.sale, price from products
inner join sale_product on products.product_id = sale_product.product

--Answer 2 --

select a.po, max(sale_bum) as "max occurence sold product", sipidik_total_price  from (
select product as "po", count(product) as "sale_bum", sum(products.price) as "sipidik_total_price"
from sale_product, products
where product_id = product
group by po , sale
) a
group by a.po, sipidik_total_price
order by max(sale_bum) desc
fetch first 1 rows only

--Answer 3 --
select po.productid ,max(sale_bum) as "number_of_occurence" , sipidik_total_price from (
select product as "productid", count(product) as "sale_bum", sum(products.price) as "sipidik_total_price"
from sale_product, products
where product_id = product
group by productid, product
) po
group by po.productid ,sipidik_total_price
order by max(sale_bum) desc
fetch first 1 rows only

--Answer 4 --
select count(*) as "total_number_of_phones_sold_with_IOS" from sale_product ,products
where sale_product.product = products.product_id and products.TYPE_PHONE_OPERATING_SYSTEM = 'IOS'

--Answer 5 --
--select * from sales--

select p1, p2, sqrt(count(*)) from (
    select
      sales1.sold_to_whom as p1 ,sales2.sold_by_whom as p2
    from
      sales sales1, sales sales2
    where
      sales1.sold_by_whom = sales2.sold_by_whom and sales1.sold_to_whom = sales2.sold_to_whom
) foo
group by p1 ,p2

--Answer 6 --

select *  from employees

update employees

set salary = (select max(salary) *0.1
	  from employees
	   group by ID order by salary desc
		fetch first 1 rows only	
	  ) + salary
where exists (select (select avg(salary) from employees)
from employees 
where salary < (select avg(salary) from employees)	 )
			 
-- Answer 7--

update products
set stock_count = 300
where stock_count = 0 and exists (
select sale_product.product as "product_id",count(sale_product.sale) as "number_of_sales", stock_count
from sale_product inner join products on product = product_id
group by sale_product.product, stock_count
having count(sale_product.sale) > (select count(*) * 0.2 from sale_product)
	)

select *from products

--Answer 8--

delete from products 
where customer_rating = (
	select min(customer_rating) from products 

)

-- Answer 9 --
 SELECT * FROM SALE_PRODUCT
select  product_catooogory ,count(product_id)
from products
inner join sale_product on product = product_id
group by product_catooogory 
order by count(product_id) desc
fetch first 1 rows only

-- Answer 10--
SELECT * FROM SALES
SELECT * FROM SALE_PRODUCT
select *
from customers
where customer_id =
(select sold_to_whom
from sales
where sale_id =
(select sale
from sale_product
inner join products on sale_product.product = products.product_id
group by sale
order by sum(price) desc
fetch first 1 rows only))
